name: ðŸ”’ Dependabot Alerts Monitor

on:
  schedule:
    - cron: "0 8 * * *"   # Chaque jour Ã  8h (UTC)
  workflow_dispatch:      # Permet un lancement manuel depuis lâ€™onglet Actions

jobs:
  check-alerts:
    runs-on: ubuntu-latest
    permissions:
      security-events: read
      contents: read
      issues: write

    steps:
      - name: ðŸ“¥ RÃ©cupÃ©ration des alertes Dependabot
        id: alerts
        run: |
          response=$(curl -s -H "Accept: application/vnd.github+json" \
                          -H "Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}" \
                          https://api.github.com/repos/${{ github.repository }}/dependabot/alerts?state=open)
          echo "$response" > alerts.json
          count=$(jq '. | length' alerts.json)
          echo "count=$count" >> $GITHUB_OUTPUT

      - name: ðŸ”” Notification
        if: steps.alerts.outputs.count != '0'
        run: |
          echo "ðŸš¨ ${{ steps.alerts.outputs.count }} alertes Dependabot dÃ©tectÃ©es !"
          echo "VÃ©rifie-les ici : https://github.com/${{ github.repository }}/security/dependabot"

      - name: âœ… Aucune alerte (optionnel)
        if: steps.alerts.outputs.count == '0'
        run: echo "âœ… Aucune nouvelle alerte Dependabot dÃ©tectÃ©e."
